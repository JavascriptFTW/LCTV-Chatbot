var Bot=function(){var e=$(".message-pane"),a=$("#message-textarea"),n=$('input[type="submit"]'),s=($(".chat-heading div").text().replace("Chat: ",""),document.body);$(".message",e).addClass("read");var t={},o={messageQueue:[],names:["Bob","Joe","Mr. Bond"],waitingMessage:0,onMessage:[]},r={commands:t};Object.defineProperty(r,t,{set:function(){}});var i={name:"Bob the bot",welcome:"{{SENDER}}: Welcome to the stream @{{TARGET}}!",enableWelcome:!0,enableHelp:!0,enableCommands:!0};$("#username-color").trigger("click"),$("#context-menu").trigger("mouseout");var m=$("#colorPremiumInput").val();return o.processMessage=function(e){for(var a=0;a<o.onMessage.length;a++)o.onMessage[a](e)},o.runCommand=function(e,a){if(i.enableCommands){var n=e.split(" "),s=n.shift();n.push({command:s,sender:a||o.names[Math.floor(Math.random(o.names.length))]}),void 0!==t[s]&&t[s].enabled&&t[s].callback.apply(r,n)}},o.resetColor=function(){o.waitingMessages||setTimeout(function(){o.waitingMessages||$(".user-color-item").eq(0).attr("data-color",m).trigger("click")},1e3)},o.sendMessage=function(e,s){s||(s={}),s.sender||(s.sender=i.name),o.waitingMessages||(m=$("#colorPremiumInput").val()),e=e.toString(),$(".user-color-item").eq(0).attr("data-color","#FFFFFF").trigger("click"),o.waitingMessages+=1,setTimeout(function(){var t=e;for(var r in s){var i="{{"+r.toUpperCase()+"}}";t=t.replace(i,s[r])}a.val(t),n.trigger("click"),o.waitingMessages-=1,o.resetColor()},2e3)},o.getMessages=function(){var a=$(".message:not(.read)",e);a.each(function(){var e=$(this);e.addClass("read"),o.messageQueue.push(e)})},o.update=function(){for(o.getMessages();o.messageQueue.length>0&&""===a.val();){var e=o.messageQueue.shift();o.processMessage(e)}setTimeout(o.update,200)},r.sendMessage=function(e,a){o.sendMessage(e,a)},i.setCommand=function(e,a,n){var s=/\((.+|)\)(?: |){([^]+)}/,o=a.toString().match(s),i=o[1].split(/(?:, |,)/g);i.push("with(this){"+o[2]+"}"),t[e]={callback:Function.apply({},i).bind(r),help:n||"No documentation supplied",enabled:!0}},i.disableCommand=function(e){void 0!==t[e]&&(t[e].enabled=!1)},i.enableCommand=function(e){void 0!==t[e]&&(t[e].enabled=!0)},i.runCommand=function(e,a){void 0!==t[e]&&t[e].callback.apply(r,a)},i.testCommand=function(e){o.runCommand(e)},i.onMessage=function(e){o.onMessage.push(e.bind(r))},i.sendMessage=o.sendMessage,i.onMessage(function(e){if(e.hasClass("message-info")){var a=e.text();if(i.enableWelcome&&-1!==a.indexOf(" joined the room.")){var n=a.slice(0,a.indexOf(" joined the room."));if(i.welcome.constructor===Array){{Math.floor(Math.random()*i.welcome.length)}o.sendMessage(i.welcome[welcomeIndex],{target:n})}else o.sendMessage(i.welcome,{target:n})}}}),i.onMessage(function(e){if(e.length){var a={sender:e[0].childNodes[0].textContent,body:e[0].childNodes[1].textContent};"/"===a.body[0]&&o.runCommand(a.body.substr(1),a.sender)}}),i.setCommand("help",function(e){if(i.enableHelp){var a=arguments[arguments.length-1],n="";if(void 0===e||void 0===t[e]){n="commands are: ";for(var s in t)n+=s+", ";n+=" (Type /help <command> for a more information about a specific command)"}else n=e+": "+t[e].help;sendMessage("{{SENDER}}: @{{TARGET}} "+n,{target:a.sender})}},"Prints documentation for all commands"),i.importExtension=function(e){var a=document.createElement("script");a.type="text/javascript",a.src=e,s.appendChild(a)},setTimeout(o.update,1),i}();