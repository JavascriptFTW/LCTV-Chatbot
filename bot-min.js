var Bot=function(){function f(a,b){b.length||(b=""),"Notification"in window&&("granted"===Notification.permission?new Notification(a,{body:b}):"denied"!==Notification.permission&&Notification.requestPermission(function(c){"granted"===c&&new Notification(a,{body:b})}))}var a={},b={messageQueue:[],names:["Joe","Mr. Bond"],waitingMessage:0,onMessage:[]},c=/\/([a-z0-9]+)(?:\/$|$|\?)/gi.exec(window.location)[1].toLowerCase(),d={commands:a,chatOwner:c,room:c+"@chat.livecoding.tv",owner:Candy.Core.getRoom(c+"@chat.livecoding.tv").user.data.nick,roster:[]};Object.defineProperty(d,"owner",{set:function(){}});var e={name:"Bob the Bot",welcome:"[{{SENDER}}]: Welcome to the stream @{{TARGET}}!",enableWelcome:!0,enableHelp:!0,enableCommands:!0};return b.processMessage=function(a,c){for(var e=0;e<b.onMessage.length;e++)b.onMessage[e].call(d,a,c)},b.runCommand=function(c,f){try{if(e.enableCommands){var g=c.split(" "),h=g.shift();g.push({command:h,sender:f||b.names[Math.floor(Math.random(b.names.length))]}),void 0!==a[h]&&a[h].enabled&&a[h].callback.apply(d,g)}}catch(i){b.sendMessage(i)}},b.sendMessage=function(a,b){b||(b={}),b.sender||(b.sender=e.name),a=a.toString();var c=a;for(var f in b)if(b.hasOwnProperty(f)){var g="{{"+f.toUpperCase()+"}}";c=c.replace(g,b[f])}Candy.Core.Action.Jabber.Room.Message(d.room,c)},b.updateRoster=function(){d.roster=[];var a=Candy.Core.getRoom(c+"@chat.livecoding.tv").roster.items;for(var b in a)if(a.hasOwnProperty(b)){var e=a[b].data.nick;d.roster.push(e)}},d.sendMessage=function(a,c){b.sendMessage(a,c)},d.inChat=function(a){return-1!==d.roster.indexOf(a)?!0:!1},e.setCommand=function(b,c,d){var e=/\((.+|)\)(?: |){([^]+)}/,f=c.toString().match(e),g=f[1].split(/(?:, |,)/g);g.push("with(this){"+f[2]+"}"),a[b]={callback:Function.apply({},g),help:d||"No documentation supplied",enabled:!0}},e.disableCommand=function(b){void 0!==a[b]&&(a[b].enabled=!1)},e.enableCommand=function(b){void 0!==a[b]&&(a[b].enabled=!0)},e.runCommand=function(b,c){void 0!==a[b]&&a[b].callback.apply(d,c)},e.testCommand=function(a){b.runCommand(a)},e.onMessage=function(a){b.onMessage.push(a.bind(d))},e.sendMessage=b.sendMessage,e.onMessage(function(a,c){"/"===c[0]?b.runCommand(c.substr(1),a):document.hasFocus()||f("New message from "+a,c)}),e.setCommand("help",function(b){if(e.enableHelp){var c=arguments[arguments.length-1],d="";if(void 0===b||void 0===a[b]){d="commands are: ";for(var f in a)a.hasOwnProperty(f)&&(d+=f+", ");d+=" (Type /help <command> for a more information about a specific command)"}else d=b+": "+a[b].help;sendMessage("[{{SENDER}}]: @{{TARGET}} "+d,{target:c.sender})}},"Prints documentation for all commands"),e.importExtension=function(a){jQuery.getScript(a)},$(Candy).on("candy:view.message.before-show",function(a,c){b.processMessage(c.name,c.message)}),$(Candy).on("candy:core.presence.room",function(a,c){var g=c.action,h=c.user.data.nick;if(c.action){if(-1===d.roster.indexOf(h)&&"join"===g&&e.enableWelcome)if(f("New viewer!",h+" has joined the stream!"),e.welcome.constructor===Array){var i=Math.floor(Math.random()*e.welcome.length);b.sendMessage(e.welcome[i],{target:h})}else b.sendMessage(e.welcome,{target:h});b.updateRoster()}}),e}();Bot.welcome=["{{SENDER}}: Welcome to the stream @{{TARGET}}!","{{SENDER}}: Hi @{{TARGET}}! Thanks for tuning in!","{{SENDER}}: Hello @{{TARGET}}! Welcome to the stream!"],Bot.setCommand("roster",function(){var a=arguments[arguments.length-1];sendMessage("@{{TARGET}} There are "+roster.length+" people in chat right now",{target:a.sender})},"Gets the number of people in the chatroom currently. Usage /roster"),Bot.setCommand("who",function(){for(var a=arguments[arguments.length-1],b="@{{TARGET}}: Users in chat are ",c=0;c<roster.length;c++){var d="";c===roster.length-1&&(d+="and "),d+=roster[c],c<roster.length-1&&(d+=", "),b+=d}sendMessage(b,{target:a.sender})},"Gets a list of the usernames of people currently in chat. Usage /who"),Bot.setCommand("roster",function(){var a=arguments[arguments.length-1];sendMessage("@{{TARGET}} There are "+roster.length+" people in chat right now",{target:a.sender})},"Gets the number of people in the chatroom currently. Usage /roster"),Bot.setCommand("who",function(){for(var a=arguments[arguments.length-1],b="@{{TARGET}}: Users in chat are ",c=0;c<roster.length;c++){var d="";c===roster.length-1&&(d+="and "),d+=roster[c],c<roster.length-1&&(d+=", "),b+=d}sendMessage(b,{target:a.sender})},"Gets a list of the usernames of people currently in chat. Usage /who");